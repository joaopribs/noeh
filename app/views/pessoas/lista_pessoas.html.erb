<% plural_pessoas = @total != 1 %>
<%
   texto_casais = []
   if @numero_casais > 0
     texto_casais << ", sendo #{@numero_casais} casa"
     if @numero_casais == 1
       texto_casais << "l"
     else
       texto_casais << "is"
     end
   end
   texto_casais = texto_casais.join
%>

<% if @tipo_pagina == "lista_pessoas" %>
    Total de <%= @total %> pessoa<%= "s" if plural_pessoas %> cadastrada<%= "s" if plural_pessoas %><%= texto_casais %>
<% elsif @tipo_pagina == "pessoas_no_grupo" %>
    Total de <%= @total %> pessoa<%= "s" if plural_pessoas %> no grupo<%= texto_casais %>
<% elsif @tipo_pagina == "pessoas_no_conjunto" %>
    <% if @conjunto.tipo == "Equipe" %>
        Total de <%= @total %> pessoa<%= "s" if plural_pessoas %> na equipe<%= texto_casais %>
    <% else %>
        Total de <%= @total %> pessoa<%= "s" if plural_pessoas %> no <%= @conjunto.encontro.denominacao_conjuntos_permanentes %><%= texto_casais %>
    <% end %>
<% end %>

<% if @total > 0 %>
    <table class="zebra">
        <thead>
        <tr>
            <th align="left">Pessoa</th>
            <th align="left" nowrap>Casado com</th>

            <% if @tipo_pagina == "lista_pessoas" %>
                <th></th>
                <th></th>
            <% elsif @tipo_pagina == "pessoas_no_grupo" %>
                <th>Coordenador</th>
                <th></th>
                <th></th>
                <th></th>
            <% elsif @tipo_pagina == "pessoas_no_conjunto" %>
                <th>Coordenador</th>
                <th></th>
            <% end %>
        </tr>
        </thead>

        <tbody>
        <% @pessoas.each do |pessoa| %>
            <%
               if @tipo_pagina == "pessoas_no_grupo" || @tipo_pagina == "pessoas_no_conjunto"
                 if @tipo_pagina == "pessoas_no_grupo"
                    relacionamento = RelacaoPessoaGrupo.where({:pessoa => pessoa, :grupo => @grupo}).first
                 elsif @tipo_pagina == "pessoas_no_conjunto"
                    relacionamento = RelacaoPessoaConjunto.where({:pessoa => pessoa, :conjunto_pessoas => @conjunto}).first
                 end
                 eh_coordenador = relacionamento.eh_coordenador
               end
            %>

            <tr>
                <td>
                    <%
                        if @tipo_pagina == "lista_pessoas"
                            link_pessoa = pessoa
                        elsif @tipo_pagina == "pessoas_no_grupo"
                            link_pessoa = grupo_pessoa_path(@grupo, pessoa)
                        elsif @tipo_pagina == "pessoas_no_conjunto"
                            if @conjunto.tipo == "Equipe"
                                link_pessoa = equipe_pessoa_path(conjunto_id: @conjunto.id, pessoa_id: pessoa.id)
                            else
                                link_pessoa = circulo_pessoa_path(conjunto_id: @conjunto.id, pessoa_id: pessoa.id)
                            end
                        end
                    %>
                    <%= link_to link_pessoa do %>
                        <table class="informacoes_pessoa_lista">
                          <tr valign="top">
                            <td>
                              <%= image_tag pessoa.url_imagem(30), class: 'imagem_pessoa_lista' %>
                            </td>
                            <td>
                              <%= "#{pessoa.nome} (#{pessoa.nome_usual})" %>
                              <div class="subtitulo_lista_pessoas">
                                Tel.: <%= pessoa.telefones.collect{|t| "#{t.telefone} (#{t.operadora})"}.join(" / ") %>
                              </div>
                            </td>
                          </tr>
                        </table>
                    <% end %>
                </td>
                <td>
                    <% if pessoa.conjuge.present? %>
                        <%

                            if @tipo_pagina == "lista_pessoas"
                                link_conjuge = pessoa.conjuge
                            elsif @tipo_pagina == "pessoas_no_grupo"
                                link_conjuge = grupo_pessoa_path(@grupo, pessoa.conjuge)
                            elsif @tipo_pagina == "pessoas_no_conjunto"
                                if @conjunto.tipo == "Equipe"
                                    link_conjuge = equipe_pessoa_path(conjunto_id: @conjunto.id, pessoa_id: pessoa.conjuge.id)
                                else
                                    link_conjuge = circulo_pessoa_path(conjunto_id: @conjunto.id, pessoa_id: pessoa.conjuge.id)
                                end
                            end
                        %>

                        <%= link_to link_conjuge do %>
                          <table class="informacoes_pessoa_lista">
                            <tr valign="top">
                              <td>
                                <%= image_tag pessoa.conjuge.url_imagem(30), class: 'imagem_pessoa_lista' %>
                              </td>
                              <td>
                                <%= "#{pessoa.conjuge.nome} (#{pessoa.conjuge.nome_usual})" %>
                                <div class="subtitulo_lista_pessoas">
                                  Tel.: <%= pessoa.conjuge.telefones.collect{|t| "#{t.telefone} (#{t.operadora})"}.join(" / ") %>
                                </div>
                              </td>
                            </tr>
                          </table>
                        <% end %>
                    <% end %>
                </td>

                <%
                    if pessoa.conjuge.nil?
                        nome_pra_dialog = pessoa.nome
                    else
                        nome_pra_dialog = "#{pessoa.nome_usual} / #{pessoa.conjuge.nome_usual}"
                    end
                %>

                <% if @tipo_pagina == "lista_pessoas" %>

                    <td align="center">
                        <%= link_to 'Editar', edit_pessoa_path(pessoa), class: 'link_editar'  if pode_editar_pessoa(pessoa) %>
                    </td>
                    <td align="center">
                         <%= link_to 'Excluir', '#', data: {pessoa_id: pessoa.id, page: @pessoas.current_page, nome_pessoa: nome_pra_dialog}, class: 'link_excluir' if pode_excluir_pessoa(pessoa) %>
                    </td>

                <% elsif @tipo_pagina == "pessoas_no_grupo" %>

                    <td align="center">
                        <% if !@usuario_logado.eh_super_admin? %>
                            <%= eh_coordenador ? "Coordenador" : "" %>
                        <% else %>
                            <input type="checkbox" name="eh_coordenador" <%= "checked" if eh_coordenador %> class="checkbox_coordenador" data-pessoa_id="<%= pessoa.id %>"/>
                        <% end %>
                    </td>

                    <td align="center">
                        <%= link_to 'Remover', '#', class: 'link_remover_do_grupo link_remover',
                                    data: {
                                        grupo_id: @grupo.id,
                                        pessoa_id: pessoa.id,
                                        nome_grupo: @grupo.nome,
                                        nome_pessoa: nome_pra_dialog,
                                        page: @pessoas.current_page
                                    }
                        %>
                    </td>

                    <td align="center">
                        <%= link_to 'Editar', grupo_edit_pessoa_path(@grupo, pessoa), class: 'link_editar' if pode_editar_pessoa(pessoa) %>
                    </td>
                    <td align="center">
                      <%= link_to 'Excluir', '#', data: {pessoa_id: pessoa.id, page: @pessoas.current_page, nome_pessoa: nome_pra_dialog}, class: 'link_excluir' if pode_excluir_pessoa(pessoa) %>
                    </td>

                <% elsif @tipo_pagina == "pessoas_no_conjunto" %>

                    <td align="center">
                        <% if !@usuario_logado.eh_super_admin? %>
                            <%= eh_coordenador ? "Coordenador" : "" %>
                        <% else %>
                            <input type="checkbox" name="eh_coordenador" <%= "checked" if eh_coordenador %> class="checkbox_coordenador" data-pessoa_id="<%= pessoa.id %>"/>
                        <% end %>
                    </td>

                    <td align="center">
                      <%= link_to 'Remover', '#', class: 'link_remover_do_conjunto link_remover',
                                  data: {
                                          conjunto_id: @conjunto.id,
                                          pessoa_id: pessoa.id,
                                          nome_conjunto: @conjunto.nome,
                                          tipo_conjunto: @conjunto.tipo_do_conjunto,
                                          nome_pessoa: nome_pra_dialog,
                                          page: @pessoas.current_page
                                  }
                      %>
                    </td>

                <% end %>

            </tr>

        <% end %>
        </tbody>
    </table>
<% end %>

<%= paginate @pessoas %>